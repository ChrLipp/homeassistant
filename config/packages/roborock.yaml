camera:
  - platform: xiaomi_cloud_map_extractor
    name: sunny
    host: !secret xiaomi_vacuum_host
    token: !secret xiaomi_vacuum_token
    username: !secret xiaomi_cloud_username
    password: !secret xiaomi_cloud_password
    country: de
    draw: ['all']
    attributes:
      - calibration_points

automation:
  - id: 'disable_vacuum_camera_update'
    alias: 'Service: disable vacuum camera update when docked'
    use_blueprint:
      path: PiotrMachowski/disable_vacuum_camera_update_when_docked.yaml
      input:
        vacuum: vacuum.sunny
        camera: camera.sunny

  - id: 'notify_sunny_error'
    alias: 'Notify: Sunny error'
    trigger:
      - entity_id: vacuum.sunny
        platform: state
        to: 'error'
        for: "00:00:03"
    action:
      - action: notify.send_message
        data:
          entity_id: notify.telegram_all
          message: >-
            {% set error = state_attr('vacuum.sunny', 'error') %}
            {% set error_map = {
              'Clean main brush': 'Die Hauptbürste hat sich verheddert. Hauptbürste und Bürstenhalterung entfernen und reinigen.'
            } %}
            Achtung: *Sunny* hat ein Problem! ({{ error_map.get(error, error if error not in [none, 'unknown', 'None'] else 'Fehlalarm, alles gut') }})
